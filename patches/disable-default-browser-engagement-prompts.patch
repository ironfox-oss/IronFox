From 99a15e6440da440c2ae1a1a462b742b066b218cd Mon Sep 17 00:00:00 2001
From: Akash Yadav <itsaky01@gmail.com>
Date: Mon, 28 Apr 2025 11:43:13 +0530
Subject: [PATCH] fix(patches): update
 'disable-default-browser-engagement-prompts.patch' for
 'FIREFOX_138_0_BUILD1'

Signed-off-by: Akash Yadav <itsaky01@gmail.com>
---
 .../java/org/mozilla/fenix/utils/Settings.kt  | 60 +++++++++++--------
 1 file changed, 34 insertions(+), 26 deletions(-)

diff --git a/mobile/android/fenix/app/src/main/java/org/mozilla/fenix/utils/Settings.kt b/mobile/android/fenix/app/src/main/java/org/mozilla/fenix/utils/Settings.kt
index 8e271198b0..45c96e165c 100644
--- a/mobile/android/fenix/app/src/main/java/org/mozilla/fenix/utils/Settings.kt
+++ b/mobile/android/fenix/app/src/main/java/org/mozilla/fenix/utils/Settings.kt
@@ -794,12 +794,7 @@ class Settings(private val appContext: Context) : PreferencesHolder {
      * This will lead to a performance regression since that function can be expensive to call.
      */
     fun checkIfFenixIsDefaultBrowserOnAppResume(): Boolean {
-        val prefKey = appContext.getPreferenceKey(R.string.pref_key_default_browser)
-        val isDefaultBrowserNow = isDefaultBrowserBlocking()
-        val wasDefaultBrowserOnLastResume =
-            this.preferences.getBoolean(prefKey, isDefaultBrowserNow)
-        this.preferences.edit { putBoolean(prefKey, isDefaultBrowserNow) }
-        return isDefaultBrowserNow && !wasDefaultBrowserOnLastResume
+        return false
     }
 
     /**
@@ -811,40 +806,31 @@ class Settings(private val appContext: Context) : PreferencesHolder {
         return browsers.isDefaultBrowser
     }
 
-    var reEngagementNotificationShown by booleanPreference(
-        appContext.getPreferenceKey(R.string.pref_key_re_engagement_notification_shown),
-        default = false,
-    )
+    var reEngagementNotificationShown = true
 
     /**
      * Check if we should set the re-engagement notification.
      */
     fun shouldSetReEngagementNotification(): Boolean {
-        return numberOfAppLaunches <= 1 && !reEngagementNotificationShown
+        return false
     }
 
     /**
      * Check if we should show the re-engagement notification.
      */
     fun shouldShowReEngagementNotification(): Boolean {
-        return !reEngagementNotificationShown && !isDefaultBrowserBlocking()
+        return false
     }
 
     /**
      * Indicates if the re-engagement notification feature is enabled
      */
-    var reEngagementNotificationEnabled by lazyFeatureFlagPreference(
-        key = appContext.getPreferenceKey(R.string.pref_key_re_engagement_notification_enabled),
-        default = { FxNimbus.features.reEngagementNotification.value().enabled },
-        featureFlag = true,
-    )
+    var reEngagementNotificationEnabled = false
 
     /**
      * Indicates if the re-engagement notification feature is enabled
      */
-    val reEngagementNotificationType: Int
-        get() =
-            FxNimbus.features.reEngagementNotification.value().type
+    val reEngagementNotificationType: Int = 0
 
     val shouldUseAutoBatteryTheme by booleanPreference(
         appContext.getPreferenceKey(R.string.pref_key_auto_battery_theme),
@@ -2275,6 +2261,11 @@ class Settings(private val appContext: Context) : PreferencesHolder {
         default = false,
     )
 
+    /**
+     * Indicates if the Set as default browser prompt for existing users feature is enabled.
+     */
+    var setAsDefaultBrowserPromptForExistingUsersEnabled = false
+
     /**
      * Last time the Set as default Browser prompt has been displayed to the user.
      */
@@ -2310,12 +2301,29 @@ class Settings(private val appContext: Context) : PreferencesHolder {
     /**
      * Indicates if the Set as default Browser prompt should be displayed to the user.
      */
-    val shouldShowSetAsDefaultPrompt: Boolean
-        get() =
-            (System.currentTimeMillis() - lastSetAsDefaultPromptShownTimeInMillis) >
-                DAYS_BETWEEN_DEFAULT_BROWSER_PROMPTS * ONE_DAY_MS &&
-                numberOfSetAsDefaultPromptShownTimes < MAX_NUMBER_OF_DEFAULT_BROWSER_PROMPTS &&
-                coldStartsBetweenSetAsDefaultPrompts >= APP_COLD_STARTS_TO_SHOW_DEFAULT_PROMPT
+    val shouldShowSetAsDefaultPrompt: Boolean = false
+
+    /**
+     * Number of days between Set as default Browser prompts.
+     */
+    private val daysBetweenDefaultBrowserPrompts: Int
+        get() = FxNimbus.features.setAsDefaultPrompt.value().daysBetweenPrompts
+
+    /**
+     * Maximum number of times the Set as default Browser prompt can be displayed to the user.
+     */
+    private val maxNumberOfDefaultBrowserPrompts: Int = 0
+
+    /**
+     * Number of app cold starts before displaying the Set as default Browser prompt.
+     */
+    private val appColdStartsToShowDefaultPrompt: Int
+        get() = FxNimbus.features.setAsDefaultPrompt.value().appColdStartsBetweenPrompts
+
+    /**
+     * Indicates if the Set as default Browser prompt should be displayed to the user.
+     */
+    val shouldShowSetAsDefaultPrompt: Boolean = false
 
     /**
      * Updates the relevant settings when the "Set as Default Browser" prompt is shown.
-- 
2.49.0

