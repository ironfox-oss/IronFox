From 56d6d6bcf2da868fb5f39e736b49a071e6a7ad5e Mon Sep 17 00:00:00 2001
From: celenity <celenity@celenity.dev>
Date: Tue, 17 Feb 2026 03:35:42 +0000
Subject: [PATCH] fix: Remove proprietary, tracking, and other unwanted
 libraries from Fenix

Signed-off-by: celenity <celenity@celenity.dev>
---
 mobile/android/fenix/.buildconfig.yml         | 10 +++---
 mobile/android/fenix/app/build.gradle         | 20 +++++------
 mobile/android/fenix/app/proguard-rules.pro   |  4 +--
 .../fenix/app/src/main/AndroidManifest.xml    | 14 ++++----
 .../mozilla/fenix/components/Components.kt    | 36 +++++++++----------
 .../settings/SecretDebugSettingsFragment.kt   |  4 +--
 .../fenix/settings/SettingsFragment.kt        |  2 +-
 .../java/org/mozilla/fenix/utils/Settings.kt  |  2 +-
 8 files changed, 46 insertions(+), 46 deletions(-)

diff --git a/mobile/android/fenix/.buildconfig.yml b/mobile/android/fenix/.buildconfig.yml
index 5c550dfa554e..4b9882fa9fea 100644
--- a/mobile/android/fenix/.buildconfig.yml
+++ b/mobile/android/fenix/.buildconfig.yml
@@ -59,19 +59,19 @@ projects:
     - components:feature-top-sites
     - components:feature-webauthn
     - components:feature-webcompat
-    - components:feature-webcompat-reporter
+#    - components:feature-webcompat-reporter
     - components:feature-webnotifications
     - components:lib-crash
-    - components:lib-crash-sentry
+#    - components:lib-crash-sentry
     - components:lib-dataprotect
     - components:lib-publicsuffixlist
-    - components:lib-push-firebase
+#    - components:lib-push-firebase
     - components:lib-state
     - components:service-digitalassetlinks
     - components:service-firefox-accounts
-    - components:service-glean
+#    - components:service-glean
     - components:service-location
-    - components:service-mars
+#    - components:service-mars
     - components:service-nimbus
     - components:service-pocket
     - components:service-sync-autofill
diff --git a/mobile/android/fenix/app/build.gradle b/mobile/android/fenix/app/build.gradle
index 1b27020a20ee..f0e4cd97c15a 100644
--- a/mobile/android/fenix/app/build.gradle
+++ b/mobile/android/fenix/app/build.gradle
@@ -598,13 +598,13 @@ dependencies {
     implementation project(':components:feature-top-sites')
     implementation project(':components:feature-webauthn')
     implementation project(':components:feature-webcompat')
-    implementation project(':components:feature-webcompat-reporter')
+//    implementation project(':components:feature-webcompat-reporter')
     implementation project(':components:feature-webnotifications')
     implementation project(':components:service-digitalassetlinks')
     implementation project(':components:service-firefox-accounts')
-    implementation project(':components:service-glean')
+//    implementation project(':components:service-glean')
     implementation project(':components:service-location')
-    implementation project(':components:service-mars')
+//    implementation project(':components:service-mars')
     implementation project(':components:service-nimbus')
     implementation project(':components:service-pocket')
     implementation project(':components:service-sync-autofill')
@@ -623,14 +623,14 @@ dependencies {
     implementation project(':components:ui-tabcounter')
     implementation project(':components:ui-widgets')
     implementation project(':components:lib-crash')
-    implementation project(':components:lib-crash-sentry')
+//    implementation project(':components:lib-crash-sentry')
     implementation project(':components:lib-dataprotect')
-    implementation project(':components:lib-push-firebase')
+//    implementation project(':components:lib-push-firebase')
     implementation project(':components:lib-state')
 
     implementation ComponentsDependencies.mozilla_appservices_syncmanager
     implementation libs.accompanist.drawablepainter
-    implementation libs.adjust
+//    implementation libs.adjust
     implementation libs.androidx.activity
     implementation libs.androidx.activity.ktx
     implementation libs.androidx.annotation
@@ -678,15 +678,15 @@ dependencies {
     implementation libs.androidx.viewpager2
     implementation libs.androidx.work.runtime
     implementation libs.google.material
-    implementation libs.installreferrer
+//    implementation libs.installreferrer
     implementation libs.kotlinx.coroutines
     implementation libs.kotlinx.serialization.json
     implementation libs.mozilla.glean
-    implementation libs.play.review
+/*    implementation libs.play.review
     implementation libs.play.review.ktx
-    implementation libs.play.services.ads.id
+    implementation libs.play.services.ads.id */
     implementation libs.protobuf.javalite
-    implementation libs.sentry
+//    implementation libs.sentry
 
     debugImplementation libs.androidx.compose.ui.tooling
     debugImplementation libs.leakcanary
diff --git a/mobile/android/fenix/app/proguard-rules.pro b/mobile/android/fenix/app/proguard-rules.pro
index 39a6df6fb62e..b4208f9c266d 100644
--- a/mobile/android/fenix/app/proguard-rules.pro
+++ b/mobile/android/fenix/app/proguard-rules.pro
@@ -9,7 +9,7 @@
 # Raptor now writes a *-config.yaml file to specify Gecko runtime settings (e.g. the profile dir). This
 # file gets deserialized into a DebugConfig object, which is why we need to keep this class
 # and its members.
--keep class org.mozilla.gecko.util.DebugConfig { *; }
+# -keep class org.mozilla.gecko.util.DebugConfig { *; }
 
 ####################################################################################################
 # Remove debug logs from release builds
@@ -27,4 +27,4 @@
 -keep class mozilla.appservices.** { *; }
 
 # Keep code generated from Glean Metrics
--keep class org.mozilla.fenix.GleanMetrics.** {  *; }
+# -keep class org.mozilla.fenix.GleanMetrics.** {  *; }
diff --git a/mobile/android/fenix/app/src/main/AndroidManifest.xml b/mobile/android/fenix/app/src/main/AndroidManifest.xml
index bc19c652029d..7db83dca9023 100644
--- a/mobile/android/fenix/app/src/main/AndroidManifest.xml
+++ b/mobile/android/fenix/app/src/main/AndroidManifest.xml
@@ -52,7 +52,7 @@
 
     <!-- Needed to get distribution information from partners.
     This is NOT required for the adjust plugin. -->
-    <uses-permission android:name="com.adjust.preinstall.READ_PERMISSION"/>
+    <!-- <uses-permission android:name="com.adjust.preinstall.READ_PERMISSION"/> -->
 
     <uses-permission android:name="${applicationId}.permission.PROFILER_INTERNAL" />
 
@@ -757,13 +757,13 @@
             android:name=".messaging.NotificationDismissedService"
             android:exported="false" />
 
-        <service
+        <!-- <service
             android:name=".push.FirebasePushService"
             android:exported="false">
             <intent-filter>
                 <action android:name="com.google.firebase.MESSAGING_EVENT" />
             </intent-filter>
-        </service>
+        </service> -->
 
         <service
             android:name=".perf.ProfilerService"
@@ -781,7 +781,7 @@
             android:readPermission="android.permission.DUMP"
             android:grantUriPermissions="false" />
 
-        <meta-data
+         <!-- <meta-data
             android:name="firebase_messaging_auto_init_enabled"
             android:value="true" />
         <meta-data
@@ -789,7 +789,7 @@
             android:value="false" />
         <meta-data
             android:name="firebase_analytics_collection_deactivated"
-            android:value="true" />
+            android:value="true" /> -->
         <!-- Removes the default Workmanager  initialization so that we can use on-demand initializer. -->
         <provider
             android:name="androidx.startup.InitializationProvider"
@@ -804,14 +804,14 @@
 
         <!-- For adjust pre-installs -->
         <!-- https://dev.adjust.com/en/sdk/android/setup/preinstalled#system-installer-receiver-->
-        <receiver
+        <!-- <receiver
             android:name="com.adjust.sdk.AdjustPreinstallReferrerReceiver"
             android:exported="true"
             tools:ignore="ExportedReceiver">
             <intent-filter>
                 <action android:name="com.attribution.SYSTEM_INSTALLER_REFERRER" />
             </intent-filter>
-        </receiver>
+        </receiver> -->
     </application>
 
 </manifest>
diff --git a/mobile/android/fenix/app/src/main/java/org/mozilla/fenix/components/Components.kt b/mobile/android/fenix/app/src/main/java/org/mozilla/fenix/components/Components.kt
index 211aac26e6e4..23b64b347078 100644
--- a/mobile/android/fenix/app/src/main/java/org/mozilla/fenix/components/Components.kt
+++ b/mobile/android/fenix/app/src/main/java/org/mozilla/fenix/components/Components.kt
@@ -10,14 +10,14 @@ import androidx.compose.runtime.Composable
 import androidx.compose.runtime.ReadOnlyComposable
 import androidx.compose.ui.platform.LocalContext
 import androidx.core.app.NotificationManagerCompat
-import com.google.android.play.core.review.ReviewManagerFactory
+// import com.google.android.play.core.review.ReviewManagerFactory
 import mozilla.components.feature.addons.AddonManager
 import mozilla.components.feature.addons.amo.AMOAddonsProvider
 import mozilla.components.feature.addons.migration.DefaultSupportedAddonsChecker
 import mozilla.components.feature.addons.update.DefaultAddonUpdater
 import mozilla.components.feature.autofill.AutofillConfiguration
-import mozilla.components.lib.crash.store.CrashAction
-import mozilla.components.lib.crash.store.CrashMiddleware
+// import mozilla.components.lib.crash.store.CrashAction
+// import mozilla.components.lib.crash.store.CrashMiddleware
 import mozilla.components.lib.publicsuffixlist.PublicSuffixList
 import mozilla.components.support.base.android.DefaultProcessInfoProvider
 import mozilla.components.support.base.android.NotificationsDelegate
@@ -40,9 +40,9 @@ import org.mozilla.fenix.components.appstate.AppAction
 import org.mozilla.fenix.components.appstate.AppState
 import org.mozilla.fenix.components.appstate.setup.checklist.SetupChecklistState
 import org.mozilla.fenix.components.appstate.setup.checklist.getSetupChecklistCollection
-import org.mozilla.fenix.components.metrics.MetricsMiddleware
+/* import org.mozilla.fenix.components.metrics.MetricsMiddleware
 import org.mozilla.fenix.crashes.CrashReportingAppMiddleware
-import org.mozilla.fenix.crashes.SettingsCrashReportCache
+import org.mozilla.fenix.crashes.SettingsCrashReportCache */
 import org.mozilla.fenix.datastore.pocketStoriesSelectedCategoriesDataStore
 import org.mozilla.fenix.distributions.DefaultDistributionBrowserStoreProvider
 import org.mozilla.fenix.distributions.DefaultDistributionProviderChecker
@@ -53,15 +53,15 @@ import org.mozilla.fenix.ext.components
 import org.mozilla.fenix.ext.filterState
 import org.mozilla.fenix.ext.settings
 import org.mozilla.fenix.ext.sort
-import org.mozilla.fenix.home.PocketMiddleware
-import org.mozilla.fenix.home.SettingsBackedPocketSettings
+// import org.mozilla.fenix.home.PocketMiddleware
+// import org.mozilla.fenix.home.SettingsBackedPocketSettings
 import org.mozilla.fenix.home.blocklist.BlocklistHandler
 import org.mozilla.fenix.home.blocklist.BlocklistMiddleware
-import org.mozilla.fenix.home.middleware.HomeTelemetryMiddleware
+// import org.mozilla.fenix.home.middleware.HomeTelemetryMiddleware
 import org.mozilla.fenix.home.setup.store.DefaultSetupChecklistRepository
 import org.mozilla.fenix.home.setup.store.SetupChecklistPreferencesMiddleware
-import org.mozilla.fenix.home.setup.store.SetupChecklistTelemetryMiddleware
-import org.mozilla.fenix.messaging.state.MessagingMiddleware
+// import org.mozilla.fenix.home.setup.store.SetupChecklistTelemetryMiddleware
+// import org.mozilla.fenix.messaging.state.MessagingMiddleware
 import org.mozilla.fenix.nimbus.FxNimbus
 import org.mozilla.fenix.onboarding.FenixOnboarding
 import org.mozilla.fenix.perf.AppLinkIntentLaunchTypeProvider
@@ -70,7 +70,7 @@ import org.mozilla.fenix.perf.StartupActivityLog
 import org.mozilla.fenix.perf.StartupStateProvider
 import org.mozilla.fenix.perf.StrictModeManager
 import org.mozilla.fenix.perf.lazyMonitored
-import org.mozilla.fenix.reviewprompt.ReviewPromptMiddleware
+// import org.mozilla.fenix.reviewprompt.ReviewPromptMiddleware
 import org.mozilla.fenix.settings.settingssearch.DefaultFenixSettingsIndexer
 import org.mozilla.fenix.termsofuse.TermsOfUseManager
 import org.mozilla.fenix.termsofuse.store.DefaultTermsOfUsePromptRepository
@@ -221,7 +221,7 @@ class Components(private val context: Context) {
     val publicSuffixList by lazyMonitored { PublicSuffixList(context) }
     val clipboardHandler by lazyMonitored { ClipboardHandler(context) }
     val performance by lazyMonitored { PerformanceComponent() }
-    val push by lazyMonitored { Push(context, analytics.crashReporter) }
+    val push by lazyMonitored { Push(context) }
     val wifiConnectionMonitor by lazyMonitored { WifiConnectionMonitor(context as Application) }
 
     val strictMode by lazyMonitored {
@@ -236,7 +236,7 @@ class Components(private val context: Context) {
 
     val playStoreReviewPromptController by lazyMonitored {
         PlayStoreReviewPromptController(
-            manager = ReviewManagerFactory.create(context),
+//            manager = ReviewManagerFactory.create(context),
             numberOfAppLaunches = { settings.numberOfAppLaunches },
         )
     }
@@ -288,7 +288,7 @@ class Components(private val context: Context) {
                 ProfileMarkerMiddleware(markerName = "AppStore", profiler = core.engine.profiler),
                 LogMiddleware(tag = "AppStore", shouldIncludeDetailedData = { Config.channel.isDebug }),
                 BlocklistMiddleware(blocklistHandler),
-                PocketMiddleware(
+/*                PocketMiddleware(
                     lazyMonitored { core.pocketStoriesService },
                     context.pocketStoriesSelectedCategoriesDataStore,
                     SettingsBackedPocketSettings(settings),
@@ -309,9 +309,9 @@ class Components(private val context: Context) {
                         currentTimeInMillis = { System.currentTimeMillis() },
                     ),
                 ),
-                HomeTelemetryMiddleware(),
+                HomeTelemetryMiddleware(), */
                 SetupChecklistPreferencesMiddleware(DefaultSetupChecklistRepository(context)),
-                SetupChecklistTelemetryMiddleware(),
+/*                SetupChecklistTelemetryMiddleware(),
                 ReviewPromptMiddleware(
                     shouldUseNewTriggerCriteria = { settings.newReviewPromptTriggerCriteriaEnabled },
                     shouldShowCustomPrompt = { settings.customReviewPromptUiEnabled && settings.isTelemetryEnabled },
@@ -319,12 +319,12 @@ class Components(private val context: Context) {
                     nimbusEventStore = nimbus.events,
                 ).also {
                     settings.migrateLastReviewPromptTimePrefIfNeeded(nimbus.events)
-                },
+                }, */
                 AppVisualCompletenessMiddleware(performance.visualCompletenessQueue),
             ),
         ).also {
             it.dispatch(AppAction.SetupChecklistAction.Init)
-            it.dispatch(AppAction.CrashActionWrapper(CrashAction.Initialize))
+//            it.dispatch(AppAction.CrashActionWrapper(CrashAction.Initialize))
         }
     }
 
diff --git a/mobile/android/fenix/app/src/main/java/org/mozilla/fenix/settings/SecretDebugSettingsFragment.kt b/mobile/android/fenix/app/src/main/java/org/mozilla/fenix/settings/SecretDebugSettingsFragment.kt
index fc8f2e51ff1e..94135bbc5d85 100644
--- a/mobile/android/fenix/app/src/main/java/org/mozilla/fenix/settings/SecretDebugSettingsFragment.kt
+++ b/mobile/android/fenix/app/src/main/java/org/mozilla/fenix/settings/SecretDebugSettingsFragment.kt
@@ -27,7 +27,7 @@ import mozilla.components.compose.base.button.FilledButton
 import mozilla.components.lib.state.ext.observeAsState
 import org.mozilla.fenix.R
 import org.mozilla.fenix.components.components
-import org.mozilla.fenix.components.metrics.MarketingAttributionService
+// import org.mozilla.fenix.components.metrics.MarketingAttributionService
 import org.mozilla.fenix.distributions.DefaultDistributionProviderChecker
 import org.mozilla.fenix.ext.showToolbar
 import org.mozilla.fenix.theme.FirefoxTheme
@@ -69,7 +69,7 @@ private fun SecretDebugSettingsScreen() {
     val playInstallReferrer: String by remember {
         mutableStateOf(
             """
-                rawValue: ${MarketingAttributionService.response}
+                rawValue: ""
                 utmTerm: ${settings.utmTerm}
                 utmMedium: ${settings.utmMedium}
                 utmSource: ${settings.utmSource}
diff --git a/mobile/android/fenix/app/src/main/java/org/mozilla/fenix/settings/SettingsFragment.kt b/mobile/android/fenix/app/src/main/java/org/mozilla/fenix/settings/SettingsFragment.kt
index 4ecf8c8e6467..6e17bfe84822 100644
--- a/mobile/android/fenix/app/src/main/java/org/mozilla/fenix/settings/SettingsFragment.kt
+++ b/mobile/android/fenix/app/src/main/java/org/mozilla/fenix/settings/SettingsFragment.kt
@@ -502,7 +502,7 @@ class SettingsFragment : PreferenceFragmentCompat() {
 
             // About preferences
             resources.getString(R.string.pref_key_rate) -> {
-                components.playStoreReviewPromptController.tryLaunchPlayStoreReview(requireActivity())
+//                components.playStoreReviewPromptController.tryLaunchPlayStoreReview(requireActivity())
                 null
             }
 
diff --git a/mobile/android/fenix/app/src/main/java/org/mozilla/fenix/utils/Settings.kt b/mobile/android/fenix/app/src/main/java/org/mozilla/fenix/utils/Settings.kt
index 81d95a9666a1..eaee0f1fc5c1 100644
--- a/mobile/android/fenix/app/src/main/java/org/mozilla/fenix/utils/Settings.kt
+++ b/mobile/android/fenix/app/src/main/java/org/mozilla/fenix/utils/Settings.kt
@@ -2218,7 +2218,7 @@ class Settings(
      */
     var shouldShowMarketingOnboarding by booleanPreference(
         appContext.getPreferenceKey(R.string.pref_key_should_show_marketing_onboarding),
-        default = true,
+        default = false,
     )
 
     var shouldUseComposableToolbar by booleanPreference(
diff --git a/mobile/android/fenix/app/src/main/java/com/google/firebase/messaging/FirebaseMessagingService.java b/mobile/android/fenix/app/src/main/java/com/google/firebase/messaging/FirebaseMessagingService.java
new file mode 100644
index 0000000000..4d5fd8153d
--- /dev/null
+++ b/mobile/android/fenix/app/src/main/java/com/google/firebase/messaging/FirebaseMessagingService.java
@@ -0,0 +1,42 @@
+// Copyright 2020 Google LLC
+//
+// Licensed under the Apache License, Version 2.0 (the "License");
+// you may not use this file except in compliance with the License.
+// You may obtain a copy of the License at
+//
+//      http://www.apache.org/licenses/LICENSE-2.0
+//
+// Unless required by applicable law or agreed to in writing, software
+// distributed under the License is distributed on an "AS IS" BASIS,
+// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+// See the License for the specific language governing permissions and
+// limitations under the License.
+package com.google.firebase.messaging;
+
+import android.app.Service;
+import android.content.Intent;
+import android.os.Binder;
+import android.os.IBinder;
+
+public class FirebaseMessagingService extends Service {
+
+    private final IBinder mBinder = new Binder();
+
+    public void onMessageReceived(RemoteMessage message) {
+    }
+
+    public void onMessageSent(String msgId) {
+    }
+
+    public void onNewToken(String token) {
+    }
+
+    public void onSendError(String msgId, Exception exception) {
+    }
+
+    @Override
+    public IBinder onBind(Intent intent) {
+        return mBinder;
+    }
+
+}
diff --git a/mobile/android/fenix/app/src/main/java/com/google/firebase/messaging/RemoteMessage.java b/mobile/android/fenix/app/src/main/java/com/google/firebase/messaging/RemoteMessage.java
new file mode 100644
index 0000000000..9ad59a31e4
--- /dev/null
+++ b/mobile/android/fenix/app/src/main/java/com/google/firebase/messaging/RemoteMessage.java
@@ -0,0 +1,33 @@
+// Copyright 2020 Google LLC
+//
+// Licensed under the Apache License, Version 2.0 (the "License");
+// you may not use this file except in compliance with the License.
+// You may obtain a copy of the License at
+//
+//      http://www.apache.org/licenses/LICENSE-2.0
+//
+// Unless required by applicable law or agreed to in writing, software
+// distributed under the License is distributed on an "AS IS" BASIS,
+// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+// See the License for the specific language governing permissions and
+// limitations under the License.
+package com.google.firebase.messaging;
+
+import android.os.Parcel;
+import android.os.Parcelable;
+import java.util.Map;
+
+public class RemoteMessage implements Parcelable {
+
+    public int describeContents() {
+        return 0;
+    }
+
+    public void writeToParcel(Parcel out, int flags) {
+    }
+
+    public Map<String, String> getData() {
+        return null;
+    }
+
+}
diff --git a/mobile/android/fenix/app/src/main/java/mozilla/components/lib/push/firebase/AbstractFirebasePushService.kt b/mobile/android/fenix/app/src/main/java/mozilla/components/lib/push/firebase/AbstractFirebasePushService.kt
new file mode 100644
index 0000000000..b50a6f03a2
--- /dev/null
+++ b/mobile/android/fenix/app/src/main/java/mozilla/components/lib/push/firebase/AbstractFirebasePushService.kt
@@ -0,0 +1,32 @@
+/* This Source Code Form is subject to the terms of the Mozilla Public
+ * License, v. 2.0. If a copy of the MPL was not distributed with this
+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
+
+package mozilla.components.lib.push.firebase
+
+import android.content.Context
+import com.google.firebase.messaging.FirebaseMessagingService
+import com.google.firebase.messaging.RemoteMessage
+import mozilla.components.concept.push.PushService
+
+abstract class AbstractFirebasePushService() : FirebaseMessagingService(), PushService {
+
+    override fun start(context: Context) {
+    }
+
+    override fun onNewToken(newToken: String) {
+    }
+
+    override fun onMessageReceived(remoteMessage: RemoteMessage?) {
+    }
+
+    final override fun stop() {
+    }
+
+    override fun deleteToken() {
+    }
+
+    override fun isServiceAvailable(context: Context): Boolean {
+        return false
+    }
+}
-- 
2.53.0

